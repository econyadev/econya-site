<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Econya — Vos économies grandissent avec vous</title>
  <meta name="description" content="Comparez, enregistrez et suivez vos progrès. Coach Eco, comparateur et bons plans." />

  <!-- CSP simple : ressources locales + appel API backend -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self';
          script-src 'self';
          style-src 'self';
          img-src 'self' data:;
          connect-src 'self' https://econya-backend.onrender.com;
          object-src 'none';
          base-uri 'self';
          frame-ancestors 'self';
        ">

  <!-- Favicons / logos (RACINE) -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />

  <!-- CSS (RACINE) -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <noscript>Activez JavaScript pour profiter du site.</noscript>

  <header class="topbar">
    <a class="brand" href="/">
      <!-- logo en RACINE -->
      <img src="logo.svg" alt="Econya" height="28" />
      <span>Econya</span>
    </a>
    <nav class="nav">
      <a href="comparateur.html">Comparateur Pro</a>
      <a href="coach.html">Coach Eco</a>
      <a href="partenaires.html">Partenaires</a>
    </nav>
  </header>

  <main class="hero">
    <h1>Vos économies grandissent avec vous</h1>
    <p>Comparez, enregistrez et suivez vos progrès.</p>

    <div class="cta">
      <a class="btn" href="comparateur.html">Essayer le comparateur</a>
      <a class="btn ghost" href="playbooks.html">Voir les Playbooks</a>
    </div>

    <!-- Badge de statut backend -->
    <div id="api-status"
         style="margin-top:16px;padding:8px 12px;border-radius:8px;display:inline-block;background:#eee;color:#333;font-weight:600">
      Vérification du backend…
    </div>
  </main>

  <footer class="footer">
    <span id="year"></span> © Econya
  </footer>

  <!-- Variables d’environnement (assets/) -->
  <script src="assets/env.js" defer></script>

  <!-- Script principal (RACINE) -->
  <script src="main.js" defer></script>

  <!-- Petit script d’appoint (année + badge) -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // année auto
      const y = document.getElementById('year');
      if (y) y.textContent = new Date().getFullYear();

      // indicateur visuel du backend
      const el = document.getElementById('api-status');
      const base = (window.ECONYA_API_BASE || '').replace(/\/+$/, '');
      if (!base) {
        el.textContent = 'Backend non configuré';
        el.style.background = '#ffd9d9';
        el.style.color = '#a00';
        return;
      }
      try {
        const res = await fetch(base + '/health', { mode: 'cors' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json().catch(() => ({}));
        el.textContent = 'Backend connecté ✅ ' + (data.version ? '(' + data.version + ')' : '');
        el.style.background = '#d7f5dd';
        el.style.color = '#115c2d';
      } catch (e) {
        el.textContent = 'Backend indisponible ❌';
        el.style.background = '#ffd9d9';
        el.style.color = '#a00';
        console.error('Backend KO:', e);
      }
    });
  </script>
</body>
</html>
