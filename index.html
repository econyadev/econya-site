<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Econya – Vos économies grandissent avec vous</title>
  <meta name="description" content="Comparez, optimisez vos dépenses et profitez de bons plans. Coach Éco, gamification et profils personnalisés." />
  <link rel="icon" type="image/svg+xml" href="assets/logo.svg" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .pill{display:inline-flex;align-items:center;gap:.5rem;padding:.35rem .6rem;border-radius:999px;font-weight:600;font-size:.85rem}
    .ok{background:#d7f5dd;color:#115c2d}.ko{background:#ffe4e4;color:#8c1b1b}.ghost{background:transparent;border:1px solid #2a7b4f33}
    .grid3{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .card{background:#0f3c2a66;border:1px solid #ffffff12;border-radius:16px;padding:16px}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:60;padding:16px}
    .modal.open{display:flex}
    .modal-card{max-width:560px;width:100%;background:#0f2e20;color:#eaf7ef;border-radius:16px;padding:20px;border:1px solid rgba(255,255,255,.08)}
    .tip{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px 14px;margin:10px 0}
  </style>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' https://econya-backend.onrender.com; object-src 'none'; base-uri 'self'; frame-ancestors 'self';">
</head>
<body>
<header class="topbar container">
  <a class="brand" href="/">
    <img src="assets/logo.svg" alt="Econya" height="28" />
    <span>Econya</span>
  </a>
  <nav class="nav">
    <a href="comparateur.html">Comparateur</a>
    <a href="coach-eco.html">Coach Éco</a>
    <a href="deals.html">Bons plans</a>
    <a href="gamification.html">Gamification</a>
    <a href="profil-eco.html">Profil éco</a>
    <a href="banque.html">Banque</a>
    <a href="tarifs.html" class="badge">Tarifs</a>
  </nav>
</header>

<main class="container hero">
  <h1>Vos économies grandissent <span style="color:#9EF01A">avec vous</span></h1>
  <p>Comparez, analysez vos dépenses et profitez de bons plans pertinents. Simplement.</p>
  <div class="cta-row" style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:12px 0">
    <a class="btn" href="comparateur.html">Essayer le comparateur</a>
    <a class="btn ghost" href="deals.html">Voir les bons plans</a>
    <button id="btn-optimiser" class="btn" style="background:#2bb673">Optimiser</button>
    <span id="api-status" class="pill ghost">Vérification du backend…</span>
  </div>

  <section class="section">
    <h2>Pourquoi Econya ?</h2>
    <div class="grid3">
      <article class="card"><h3>Comparaisons claires</h3><p>Multi-critères pondérés, résultats lisibles, KPIs utiles.</p></article>
      <article class="card"><h3>Coach intelligent</h3><p>Détection de dépenses, objectifs, conseils actionnables.</p></article>
      <article class="card"><h3>Gamification</h3><p>Plante d’épargne, badges, défis hebdos pour rester motivé.</p></article>
    </div>
  </section>
</main>

<footer class="container">
  <span id="year"></span> © Econya
</footer>

<!-- MODAL Optimiser -->
<div id="optimiser-modal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <div><h3>3 conseils rapides pour optimiser</h3><p>Basés sur vos catégories et nos heuristiques.</p></div>
      <button id="close-optimiser" class="btn ghost">Fermer</button>
    </div>
    <div id="optimiser-tips" style="margin-top:8px"></div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <a class="btn" href="coach-eco.html">Aller sur Coach Eco</a>
      <a class="btn ghost" href="deals.html">Voir des bons plans</a>
    </div>
  </div>
</div>

<script src="assets/env.js"></script>
<script>
  const $ = s=>document.querySelector(s);
  const apiBase = (window.ECONYA_API_BASE||"").replace(/\/+$/,"");
  document.getElementById("year").textContent = new Date().getFullYear();

  // Badge backend
  (async ()=>{
    const el = $("#api-status");
    if(!apiBase){ el.textContent="Backend non configuré"; el.className="pill ko"; return; }
    try{
      const r = await fetch(apiBase + "/sante", {mode:"cors"});
      el.textContent = r.ok ? "Backend connecté" : "Backend indisponible";
      el.className = "pill " + (r.ok?"ok":"ko");
    }catch{ el.textContent="Backend indisponible"; el.className="pill ko"; }
  })();

  // Optimiser (même logique que déjà fournie)
  function getCategories(){
    try{
      const raw = localStorage.getItem('eco-categories');
      const arr = raw ? JSON.parse(raw) : null;
      if (Array.isArray(arr) && arr.length) return arr;
    }catch{}
    return ["Énergie","Télécom","Assurance","Courses","Transport","Banque"];
  }
  function euro(n){ try{return new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'}).format(n);}catch{return n.toFixed(2)+' €';} }
  function makeTips(categories){
    const tips=[]; const has=c=>categories.some(x=>(x||"").toLowerCase().includes(c.toLowerCase()));
    if(has("Énergie")) tips.push({title:"Baisser la facture d’énergie",text:"Comparez indexé vs fixe, suivez le kWh moyen. Gain cible : "+euro(120)+"/an.",link:"deals.html?cat=energie",cta:"Comparer énergie"});
    if(has("Télécom")) tips.push({title:"Forfait mobile/box moins cher", text:"Passez sur un MVNO (sans engagement). Gain cible : "+euro(90)+"/an.", link:"deals.html?cat=telecom", cta:"Voir forfaits"});
    if(has("Assurance")) tips.push({title:"Renégocier vos assurances",   text:"Pack auto+habitation souvent -10–20%.", link:"deals.html?cat=assurance", cta:"Comparer"});
    if(tips.length<3 && has("Courses")) tips.push({title:"Courses optimisées", text:"MDD + cashback + anti-gaspi. Gain cible : "+euro(180)+"/an.", link:"deals.html?cat=courses", cta:"Activer cashback"});
    if(tips.length<3 && has("Transport")) tips.push({title:"Carburant & trajets", text:"Stations moins chères + éco-conduite.", link:"deals.html?cat=transport", cta:"Voir options"});
    if(tips.length<3) tips.push({title:"Frais bancaires & épargne", text:"Coupez les frais et automatisez une épargne mensuelle.", link:"coach-eco.html#banque", cta:"Ouvrir Coach"});
    return tips.slice(0,3);
  }
  function openOptimiser(){
    const wrap=$("#optimiser-tips"); wrap.innerHTML="";
    makeTips(getCategories()).forEach(t=>{
      const d=document.createElement("div");
      d.className="tip";
      d.innerHTML=`<strong>${t.title}</strong><p style="margin:6px 0 10px">${t.text}</p><a class="btn" href="${t.link}">${t.cta}</a>`;
      wrap.appendChild(d);
    });
    $("#optimiser-modal").classList.add("open"); $("#optimiser-modal").setAttribute("aria-hidden","false");
  }
  function closeOptimiser(){ $("#optimiser-modal").classList.remove("open"); $("#optimiser-modal").setAttribute("aria-hidden","true"); }
  $("#btn-optimiser").addEventListener("click", openOptimiser);
  $("#close-optimiser").addEventListener("click", closeOptimiser);
  $("#optimiser-modal").addEventListener("click",(e)=>{ if(e.target.id==="optimiser-modal") closeOptimiser(); });
</script>
</body>
</html>


