<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Comparateur — Econya</title>
  <meta name="description" content="Comparez vos options et estimez vos économies avec Econya." />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <a class="brand" href="index.html"><img class="brand-mark" src="logo.svg" alt="" /><span class="brand-name">Econya</span></a>
    <nav class="nav" aria-label="Navigation principale">
      <a href="comparateur.html" aria-current="page">Comparateur</a>
      <a href="coach-eco.html">Coach Éco</a>
      <a href="partenaires.html">Partenaires</a>
      <a href="playbooks.html">Playbooks</a>
    </nav>
  </header>

  <main class="container" style="padding:24px 0 40px">
    <h1>Comparateur</h1>
    <p class="sub">Page de démo. Le backend est : <span id="api-status" class="badge">Vérification…</span></p>

    <section class="card" style="margin-top:16px">
      <h2 style="margin-top:0">Votre situation</h2>
      <form id="form" class="grid-3" style="gap:12px">
        <label class="card">
          <span>Catégorie</span>
          <select id="cat" required>
            <option value="mobile">Téléphonie mobile</option>
            <option value="internet">Internet</option>
            <option value="banque">Banque</option>
            <option value="energie">Énergie</option>
          </select>
        </label>
        <label class="card">
          <span>Dépense actuelle (€/mois)</span>
          <input id="current" type="number" min="0" step="0.1" placeholder="ex: 39.90" required />
        </label>
        <label class="card">
          <span>Objectif d’économie (%)</span>
          <input id="target" type="number" min="0" max="90" step="1" value="20" />
        </label>
        <button class="btn" style="grid-column: 1 / -1" type="submit">Comparer</button>
      </form>
    </section>

    <section id="results" class="grid-3" style="margin-top:16px"></section>

    <div style="margin-top:18px">
      <a class="btn ghost" href="coach-eco.html" id="to-coach">Passer au Coach Éco</a>
    </div>
  </main>

  <footer class="footer">
    <div class="container footer-inner">
      <div class="footer-brand"><img class="brand-mark" src="logo.svg" alt="" /><span class="brand-name">Econya</span></div>
      <nav class="footer-nav"><a href="legal.html">Mentions légales</a><a href="vie-privée.html">Vie privée</a><a href="partenaires.html">Partenaires</a><a href="contact.html">Contact</a></nav>
      <div class="copy"><span id="year"></span> © Econya</div>
    </div>
  </footer>

  <script src="actifs/env.js"></script>
  <script src="main.js"></script>
  <script>
    // Hydrate depuis l’URL si le Coach a pré-rempli ?cat=&current=&target=
    const params = new URLSearchParams(location.search);
    if (params.has('cat')) document.getElementById('cat').value = params.get('cat');
    if (params.has('current')) document.getElementById('current').value = params.get('current');
    if (params.has('target')) document.getElementById('target').value = params.get('target');

    // Démo sans backend : on fabrique 3 offres “simulées”
    const OFFRES = [
      { nom:"Offre Essentielle", gain: .15 },
      { nom:"Offre Plus",       gain: .22 },
      { nom:"Offre Max",        gain: .28 },
    ];

    document.getElementById('form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const cat = document.getElementById('cat').value;
      const current = Math.max(0, parseFloat(document.getElementById('current').value||0));
      const target = Math.max(0, Math.min(90, parseFloat(document.getElementById('target').value||0))) / 100;

      const wrap = document.getElementById('results');
      wrap.innerHTML = '';
      OFFRES.forEach(o=>{
        const price = (current * (1 - o.gain)).toFixed(2);
        const save  = (current - price).toFixed(2);
        const hitTarget = o.gain >= target;

        const el = document.createElement('article');
        el.className = 'card';
        el.innerHTML = `
          <h3 style="margin-top:0">${o.nom} — ${cat}</h3>
          <p>Prix estimé : <strong>${price}€/mois</strong></p>
          <p>Économie vs actuel : <strong>${save}€/mois</strong> (${Math.round(o.gain*100)}%)</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn">Choisir</button>
            <span class="badge" style="background:${hitTarget?'#d7f5dd':'#ffd9d9'};color:${hitTarget?'#115c2d':'#a00'}">
              ${hitTarget ? 'Atteint l’objectif ✅' : 'Sous l’objectif ❌'}
            </span>
          </div>
        `;
        wrap.appendChild(el);
      });

      // Lien de retour vers le Coach avec le contexte courant
      const url = new URL('coach-eco.html', location.href);
      url.searchParams.set('cat', cat);
      url.searchParams.set('current', current);
      url.searchParams.set('target', (target*100).toFixed(0));
      document.getElementById('to-coach').href = url.toString();
    });
  </script>
</body>
</html>

