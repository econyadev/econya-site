<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Econya — Dashboard</title>
  <meta name="description" content="Visualisez vos revenus vs dépenses et vos actions d’économies prioritaires."/>
  <meta property="og:title" content="Econya — Dashboard"/>
  <meta property="og:description" content="Visualisez vos revenus vs dépenses et vos actions d’économies prioritaires."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="/"/>
  <meta property="og:image" content="assets/logo.svg"/>
  <meta name="theme-color" content="#0e1512"/>
  <link rel="icon" type="image/svg+xml" href="favicon.svg"/>
  <link rel="apple-touch-icon" href="apple-touch-icon.png"/>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="preload" href="assets/logo.svg" as="image"/>
  <link rel="stylesheet" href="assets/style.css"/>
</head>
<body>

<header>
  <a class="brand" href="index.html" aria-label="Accueil Econya">
    <div class="logo3d" aria-hidden="true">
      <img src="assets/logo.svg" alt="" />
    
<div class="wrap">
  <h1>Dashboard</h1>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <h3>Revenus vs Dépenses (30 jours)</h3>
      <a class="btn" href="bank-link.html" data-bank-state>Connecter ma banque</a>
    </div>
    <canvas id="chart" width="900" height="320" style="width:100%;max-width:100%"></canvas>
    <script>
      (async function(){
        const days = Array.from({length:30}, (_,i)=>i+1);
        let income = days.map(()=> Math.random()*80+30);
        let spend  = days.map(()=> Math.random()*60+20);
        try {
          if(!localStorage.getItem('econya_jwt')){ await EconyaAPI.login(); }
          const to = new Date(); const from = new Date(); from.setDate(from.getDate()-30);
          const qs = `?from=${from.toISOString().slice(0,10)}&to=${to.toISOString().slice(0,10)}`;
          const r = await fetch(EconyaAPI.base + '/me/transactions'+qs, {headers: {...EconyaAPI.authHeader()}});
          if(r.ok){
            const tx = await r.json();
            income = Array(30).fill(0); spend = Array(30).fill(0);
            tx.forEach(t=>{ const d = new Date(t.date); const day = d.getDate();
              if(t.amount>=0) income[day-1] += t.amount; else spend[day-1] += Math.abs(t.amount);
            });
          }
        } catch(e){ console.warn('API fallback demo', e); }
        drawIncomeSpend(document.getElementById('chart'), income, spend);
      })();
    </script>
  </div>
</div>
<footer>
  <div>© 2025 Econya — <em>Vos économies grandissent avec vous</em>.</div>
  <nav aria-label="Liens de bas de page">
    <a href="legal.html">Mentions légales</a>
    <a href="privacy.html">Vie privée</a>
    <a href="terms.html">CGU</a>
    <a href="contact.html">Contact</a>
  </nav>
</footer>
<script src="assets/main.js"></script>
</body>
</html>
